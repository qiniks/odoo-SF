<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_api_product_tree" model="ir.ui.view">
        <field name="name">api.product.tree</field>
        <field name="model">api.product</field>
        <field name="arch" type="xml">
            <tree decoration-muted="is_converted" decoration-success="is_converted" default_order="is_converted, name">
                <field name="api_id"/>
                <field name="name"/>
                <field name="date"/>
                <field name="design"/>
                <field name="quantity"/>
                <field name="is_fast_ship"/>
                <field name="is_custom_label"/>
                <field name="category"/>
                <field name="state"/>
                <field name="delivery_status"/>
                <field name="is_converted" invisible="1"/>
                <button name="create_delivery_order"
                        string="Create Delivery"
                        type="object"
                        class="btn-primary"
                        attrs="{'invisible': [('is_converted', '=', True)]}"/>
            </tree>
        </field>
    </record>

<!-- Kanban View -->
<record id="view_api_product_kanban" model="ir.ui.view">
    <field name="name">api.product.kanban</field>
    <field name="model">api.product</field>
    <field name="arch" type="xml">
        <kanban default_group_by="state" quick_create="false" class="o_kanban_small_column" records_draggable="true">
            <!-- Define required fields -->
            <field name="api_id"/>
            <field name="name"/>
            <field name="date"/>
            <field name="design"/>
            <field name="quantity"/>
            <field name="is_converted"/>
            <field name="state"/>
            <field name="delivery_status"/>
            <field name="is_fast_ship"/>
            <field name="is_custom_label"/>

            <progressbar field="state" 
                colors='{"to_do": "secondary", "in_process": "warning", "done": "info", "delivered": "success"}'
                sum_field="quantity"/>

            <templates>
                <t t-name="kanban-box">
                    <div t-attf-class="oe_kanban_global_click">
                        <div class="oe_kanban_details">
                            <!-- Header -->
                            <div class="o_kanban_record_top mb-0">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                </div>
                            </div>
                            <!-- Status Badge -->
                            <div class="o_kanban_tags_section mb-2">
                                <span t-attf-class="badge {{ 
                                    record.state.raw_value == 'in_process' ? 'bg-warning' : 
                                    (record.state.raw_value == 'done' ? 'bg-info' : 
                                    (record.state.raw_value == 'delivered' ? 'bg-success' : 'bg-secondary')) }}">
                                    <field name="state"/>
                                </span>
                            </div>
                            <!-- Product Details -->
                            <ul class="mb-2">
                                <li><strong>API ID:</strong> <field name="api_id"/></li>
                                <li><strong>Design:</strong> <field name="design"/></li>
                                <li><strong>Date:</strong> <field name="date"/></li>
                                <li><strong>Quantity:</strong> <field name="quantity"/> pcs</li>
                                <li><strong>Fast Shipping:</strong> <field name="is_fast_ship"/></li>
                                <li><strong>Custom Label:</strong> <field name="is_custom_label"/></li>
                            </ul>
                            <!-- Footer -->
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left text-muted">
                                    <field name="delivery_status"/>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <t t-if="!record.is_converted.raw_value">
                                        <button name="create_delivery_order" 
                                                type="object" 
                                                class="btn btn-primary btn-sm">
                                            Create Delivery
                                        </button>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>

    <!-- Form View -->
    <record id="view_api_product_form" model="ir.ui.view">
        <field name="name">api.product.form</field>
        <field name="model">api.product</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_set_in_process" 
                            string="Set In Process" 
                            type="object"
                            class="btn-warning"
                            attrs="{'invisible': [('state', '!=', 'to_do')]}"/>
                    <button name="action_set_done" 
                            string="Set Done" 
                            type="object"
                            class="btn-info"
                            attrs="{'invisible': [('state', '!=', 'in_process')]}"/>
                    <button name="action_set_delivered" 
                            string="Set Delivered" 
                            type="object"
                            class="btn-success"
                            attrs="{'invisible': [('state', '!=', 'done')]}"/>
                    <field name="state" widget="statusbar" 
                    statusbar_visible="to_do,in_process,done,delivered"/>
                    <button name="create_delivery_order" 
                            string="Create Delivery Order" 
                            type="object" 
                            class="btn-primary"
                            attrs="{'invisible': [('is_converted', '=', True)]}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name" placeholder="Product Name"/></h1>
                    </div>
                    <group>
                        <group string="Basic Information">
                            <field name="api_id"/>
                            <field name="date"/>
                            <field name="design"/>
                            <field name="quantity"/>
                            <field name="category"/>
                        </group>
                        <group string="Shipping Information">
                            <field name="is_fast_ship"/>
                            <field name="is_custom_label"/>
                            <field name="state"/>
                            <field name="is_converted"/>
                            <field name="delivery_status"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View -->
<record id="view_api_product_search" model="ir.ui.view">
    <field name="name">api.product.search</field>
    <field name="model">api.product</field>
    <field name="arch" type="xml">
        <search>
            <field name="name"/>
            <field name="api_id"/>
            <field name="design"/>
            <field name="category"/>
            <separator/>
            <!-- Update state filters to match new states -->
            <filter string="To Do" name="state_to_do" domain="[('state', '=', 'to_do')]"/>
            <filter string="In Process" name="state_in_process" domain="[('state', '=', 'in_process')]"/>
            <filter string="Done" name="state_done" domain="[('state', '=', 'done')]"/>
            <filter string="Delivered" name="state_delivered" domain="[('state', '=', 'delivered')]"/>
            <separator/>
            <filter string="Ready for Delivery" name="not_converted" domain="[('is_converted', '=', False)]"/>
            <filter string="Converted to Delivery" name="converted" domain="[('is_converted', '=', True)]"/>
            <group expand="0" string="Group By">
                <filter string="State" name="groupby_state" context="{'group_by': 'state'}"/>
                <filter string="Category" name="groupby_category" context="{'group_by': 'category'}"/>
                <filter string="Design" name="groupby_design" context="{'group_by': 'design'}"/>
                <filter string="Date" name="groupby_date" context="{'group_by': 'date'}"/>
            </group>
        </search>
    </field>
</record>

    <!-- Action Window -->
    <record id="action_view_api_products" model="ir.actions.act_window">
        <field name="name">API Products</field>
        <field name="res_model">api.product</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_not_converted': 1}</field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_api_products"
              name="API Products"
              parent="stock.menu_stock_root"
              action="action_view_api_products"
              sequence="16"/>
</odoo>